/*
 * TilesSquare Maps on jQuery v0.3.0
 * http://tilessquare.org/
 *
 * Copyright 2013-2014 NAGAI Kenshin
 * Released under the MIT license
 *
 * Date: 2014-1-5
 */
function tsAWithB(B,A,C){if(!A&&!C){return true}B.options=$.extend(A,C);return false}function tsPushSuperFunc(C,A){var B=A+"_SUPS";C[B]=(C[B]?C[B]:[]);C[B].push(C[A])}function tsExecSuperFuncs(F,D,C){var B=F[D+"_SUPS"],E=true;for(var A=B.length-1;A>=0&&E!==false&&E!==null;A--){E=B[A].apply(F,C)}return E}function tsGetGetVars(){var D=[],C,A=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var B=0;B<A.length;B++){C=A[B].split("=");D.push(C[0]);D[C[0]]=C[1]}return D}function TSCache(A){if(tsAWithB(this,{},A)){return}this.status=this.NONE=0;this.WAITING=1;this.LOADED=2;this.updateATime=function(){this.atime=(new Date()).getTime()};this.updateATime()}function TSImageCache(B){if(tsAWithB(this,{fadeInSpan:200,uri:""},B)){return}TSCache.call(this,this.options);var A=this;A.status=A.WAITING;this.img=new Image();this.img.src=this.options.uri;this.img.size=0;this.img.onload=function(){A.status=A.LOADED;A.fadeInStart=(new Date()).getTime();A.fadeInEnd=A.fadeInStart+A.options.fadeInSpan;A.size=A.img.width*A.img.height}}TSImageCache.prototype=new TSCache;function TSProjection(A){if(tsAWithB(this,{lon:0,lat:0,zoom:0},A)){return}this.hasLonLat=(A&&A.lon!=undefined&&A.lat!=undefined)}function TSMercatorProjection(A){if(tsAWithB(this,{x:0,y:0},A)){return}TSProjection.call(this,this.options);this.hasXY=(A&&A.x!=undefined&&A.y!=undefined);this.trimXY=function(){var B=Math.pow(2,this.options.zoom);while(this.options.x<0){this.options.x+=B}while(this.options.x>=B){this.options.x-=B}while(this.options.y<0){this.options.y+=B}while(this.options.y>=B){this.options.y-=B}};this.trimLonLat=function(){while(this.options.lon<=-180){this.options.lon+=360}while(this.options.lon>180){this.options.lon-=360}while(this.options.lat<=-90){this.options.lat+=180}while(this.options.lat>90){this.options.lat-=180}};this.makeKey=function(){if(this.hasXY){this.trimXY()}else{this.trimLonLat();this.computeXY()}return this.options.zoom+"/"+~~this.options.x+"/"+~~this.options.y};this.computeXY=function(){this.options.x=(this.options.lon+180)/360*Math.pow(2,this.options.zoom);this.options.y=(1-Math.log(Math.tan(this.options.lat*Math.PI/180)+1/Math.cos(this.options.lat*Math.PI/180))/Math.PI)/2*Math.pow(2,this.options.zoom);this.hasXY=true};this.getXY=function(){if(this.hasXY){this.trimXY()}else{this.trimLonLat();this.computeXY()}return{x:this.options.x,y:this.options.y}};this.computeLonLat=function(){var B=Math.pow(2,this.options.zoom),C=Math.PI-2*Math.PI*this.options.y/B;this.options.lon=this.options.x/B*360-180;this.options.lat=180/Math.PI*Math.atan(0.5*(Math.exp(C)-Math.exp(-C)));this.hasLonLat=true};this.getLonLat=function(){if(this.hasLonLat){this.trimLonLat()}else{this.trimXY();this.computeLonLat()}return{lon:this.options.lon,lat:this.options.lat}}}TSMercatorProjection.prototype=new TSProjection;function TSOSMProjection(A){if(tsAWithB(this,{},A)){return}TSMercatorProjection.call(this,this.options)}TSOSMProjection.prototype=new TSMercatorProjection;function TSDownloader(A){if(tsAWithB(this,{},A)){return}}function TSOSMDownloader(A){if(tsAWithB(this,{subDomain:"a"},A)){return}TSDownloader.call(this,this.options);this.getTileCache=function(B){var C=B.getXY();return new TSImageCache({uri:"http://"+this.options.subDomain+".tile.openstreetmap.org/"+~~B.options.zoom+"/"+~~C.x+"/"+~~C.y+".png"})}}TSOSMDownloader.prototype=new TSDownloader;function TSMapQuestOSMDownloader(A){if(tsAWithB(this,{subDomain:"1"},A)){return}TSDownloader.call(this,this.options);this.getTileCache=function(B){var C=B.getXY();return new TSImageCache({uri:"http://otile"+this.options.subDomain+".mqcdn.com/tiles/1.0.0/osm/"+~~B.options.zoom+"/"+~~C.x+"/"+~~C.y+".png"})}}TSMapQuestOSMDownloader.prototype=new TSDownloader;function TSLocalDownloader(A){if(tsAWithB(this,{bpath:""},A)){return}TSDownloader.call(this,this.options);this.getTileCache=function(B){return new TSImageCache({uri:this.options.bpath+~~B.options.zoom+"/"+~~B.options.x+"/"+~~B.options.y+".png"})}}TSLocalDownloader.prototype=new TSDownloader;function TilesSquare(A){if(tsAWithB(this,{interval:50,moveSpan:700,zoomSpan:700,id:"default",dldrs:[],minZoom:0,maxZoom:18,zoom:12,lon:139.6916667,lat:35.6894444},A)){return}this.initialized=false;this.caches={};this.activated=false;this.dldrIdx=0;this.init=function(B){this.initialized=true;this.isIOS=B.isIOS;this.isAndroid=B.isAndroid;this.options.interval=B.interval;this.cvsid=B.cvsid;this.cdtid=B.cdtid;this.hasArrows=B.hasArrows;this.arw1id=B.arw1id;this.hasSlider=B.hasSlider;this.sldid=B.sldid;this.hasPlsMns=B.hasPlsMns;this.pmids=B.pmids;this.hasScale=B.hasScale;this.sclids=B.sclids;this.ovlsid=B.ovlsid;this.popsid=B.popsid;this.onActivate=B.onActivate;this.onDeactivate=B.onDeactivate;this.beforeDrag=B.beforeDrag;this.afterDrag=B.afterDrag;this.beforeMove=B.beforeMove;this.inMoving=B.inMoving;this.afterMove=B.afterMove;this.beforeZoom=B.beforeZoom;this.inZooming=B.inZooming;this.afterZoom=B.afterZoom;this.beforeResize=B.beforeResize;this.afterResize=B.afterResize;this.onDraw=B.onDraw;this.onLoaded=B.onLoaded};this.destroy=function(){};this.activate=function(B){this.activated=true;this.resize(B);this.setCenter(B);if(this.hasSlider){var C=$("#"+this.sldid);C.slider("option","min",this.options.minZoom);C.slider("option","max",this.options.maxZoom);C.slider("option","value",this.options.zoom)}this.retrieve();if(this.onActivate){this.onActivate(this)}$("#"+this.ovlsid).tsoverlays("activate",this);$("#"+this.popsid).tspopups("activate",this);this.draw()};this.deactivate=function(){this.activated=false;if(this.onDeactivate){this.onDeactivate(this)}$("#"+this.ovlsid).tsoverlays("deactivate",this);$("#"+this.popsid).tspopups("deactivate",this)};this.resize=function(B){this.width=B.width;this.height=B.height};this.updateScaleSub=function(I,G){var F=0,H=0,E=[1,2,3,5],B=99;for(var D=I;D>=1&&F==0;D/=10){if(D*G>B*100){continue}for(var C=E.length-1;C>=0;C--){H=E[C]*D;if(H*G<B){F=H*G;break}}}return{s:F,sc:H}};this.updateScale=function(O){var J=O.scale2/180*Math.PI,F=Math.PI/180*6378137*Math.cos(J)/Math.sqrt(1-0.00669447*Math.pow(Math.sin(J),2)),B=O.scale1/F,H=this.updateScaleSub(10000000,B),C=~~H.s,D=6;if(H.s>0){var I=$("#"+this.sclids.kmLine),N=$("#"+this.sclids.kmLabel);I.css("left",(C+D)+"px");N.text(H.sc>1000?(H.sc/1000)+" km":H.sc+" m")}B*=1609.344;var K=" mi";H=this.updateScaleSub(10000,B);if(H.s==0){B/=1760*3;K=" ft";H=this.updateScaleSub(1000,B)}var M=~~H.s;if(H.s>0){var G=$("#"+this.sclids.miLine);G.css("left",(M+D)+"px");var L=$("#"+this.sclids.miLabel);L.text(H.sc+K)}var E=$("#"+this.sclids.horizon);E.css("width",(C>M?C:M)+2)};this.sync=function(){if(this.hasSlider){var B=$("#"+this.sldid);B.slider("option","value",this.options.zoom)}if(this.hasScale){var C=this.deltaElem2LonLat({deltaElemX:100,deltaElemY:this.height-20-(this.height>>1)});while(C.lon<this.options.lon){C.lon+=360}this.updateScale({scale1:100/(C.lon-this.options.lon),scale2:C.lat})}};this.setCenter=function(B){this.options.zoom=(B.zoom===undefined?this.options.zoom:B.zoom);this.options.lon=(B.lon===undefined?this.options.lon:B.lon);this.options.lat=(B.lat===undefined?this.options.lat:B.lat);this.sync()};this.deltaElem2LonLat=function(B){var D=this.getProjection({zoom:this.options.zoom,lon:this.options.lon,lat:this.options.lat}),C=this.deltaProjection({prj:D,deltaZ:(B.deltaZ===undefined?0:B.deltaZ),deltaElemX:B.deltaElemX,deltaElemY:B.deltaElemY});return C.getLonLat()};this.lonLat2DeltaElem=function(B){var D=this.getProjection({zoom:this.options.zoom,lon:this.options.lon,lat:this.options.lat}),C=this.getProjection({zoom:B.zoom?B.zoom:this.options.zoom,lon:B.lon,lat:B.lat});return this.getDeltaElem(D,C)};this.dragTimer=null;this.deltaElemX=0;this.deltaElemY=0;this.onDrag=function(C){if(this.dragTimer===null){var B=this;this.dragTimer=setTimeout(function(){B.doDrag()},this.options.interval)}this.deltaElemX+=C.deltaElemX;this.deltaElemY+=C.deltaElemY};this.doDrag=function(){this.dragTimer=null;var C={deltaElemX:this.deltaElemX,deltaElemY:this.deltaElemY};this.deltaElemX=0;this.deltaElemY=0;var E=this.deltaElem2LonLat(C);this.setCenter({lon:E.lon,lat:E.lat});this.retrieve();if(this.beforeDrag){this.beforeDrag(this,C)}var D=$("#"+this.ovlsid).tsoverlays("beforeDrag",this,C),B=$("#"+this.popsid).tspopups("beforeDrag",this,C);this.draw();D.tsoverlays("afterDrag",this,C);B.tspopups("afterDrag",this,C);if(this.afterDrag){this.afterDrag(this,C)}};this.onMove=function(C){var B=(new Date()).getTime();this.moveReq={zoom:this.options.zoom,elemX:C.elemX,elemY:C.elemY,moveStart:B,moveEnd:B+this.options.moveSpan};var D=this.deltaElem2LonLat({deltaElemX:C.elemX-(this.width>>1),deltaElemY:C.elemY-(this.height>>1)});this.setCenter({lon:D.lon,lat:D.lat});this.retrieve();if(this.beforeMove){this.beforeMove(this,this.moveReq)}$("#"+this.ovlsid).tsoverlays("beforeMove",this,this.moveReq);$("#"+this.popsid).tspopups("beforeMove",this,this.moveReq);this.draw()};this.zoomTimer=null;this.deltaZ=0;this.elemX=0;this.elemY=0;this.onZoom=function(D){var C=document.getElementById(this.cvsid);this.elemX=(D.elemX===undefined?$(C).width()>>1:D.elemX);this.elemY=(D.elemY===undefined?$(C).height()>>1:D.elemY);if(D.zoom===undefined){if(this.zoomTimer===null){var B=this;this.zoomTimer=setTimeout(function(){B.doZoom(true)},this.options.interval)}this.deltaZ+=D.deltaZ}else{if(this.zoomTimer!==null){clearTimeout(this.zoomTimer);this.zoomTimer=null}this.deltaZ=D.zoom-this.options.zoom;this.doZoom(false)}};this.doZoom=function(C){this.zoomTimer=null;var H=0;if(this.deltaZ>0.9){H=Math.ceil(this.deltaZ);this.deltaZ=0}else{if(this.deltaZ<-0.9){H=Math.floor(this.deltaZ);this.deltaZ=0}}var G=this.elemX,E=this.elemY;this.elemX=0;this.elemY=0;var D=this.options.zoom+H;if(D<this.options.minZoom){D=this.options.minZoom}else{if(D>this.options.maxZoom){D=this.options.maxZoom}}if(D==this.options.zoom){return}var B=(new Date()).getTime();this.zoomReq={zoom:this.options.zoom,preserve:C,elemX:G,elemY:E,zoomStart:B,zoomEnd:B+this.options.zoomSpan};var F=this.deltaElem2LonLat({deltaZ:(C?H:0),deltaElemX:G-(this.width>>1),deltaElemY:E-(this.height>>1)});this.setCenter({zoom:D,lon:F.lon,lat:F.lat});this.retrieve();if(this.beforeZoom){this.beforeZoom(this,this.zoomReq)}$("#"+this.ovlsid).tsoverlays("beforeZoom",this,this.zoomReq);$("#"+this.popsid).tspopups("beforeZoom",this,this.zoomReq);this.draw()};this.onResize=function(C){var E={width:this.width,height:this.height};this.resize(C);this.retrieve();if(this.beforeResize){this.beforeResize(this,E)}var D=$("#"+this.ovlsid).tsoverlays("beforeResize",this,E),B=$("#"+this.popsid).tspopups("beforeResize",this,E);this.draw();D.tsoverlays("afterResize",this,E);B.tspopups("afterResize",this,E);if(this.afterResize){this.afterResize(this,E)}};this.wheel2deltaZ=function(B){return B/2};this.pinch2deltaZ=function(B){return Math.log(B)/Math.LN2*2}}function OSMTilesSquare(A){if(tsAWithB(this,{tsize:256,credit:'© <a href="http://www.openstreetmap.org/">OpenStreetMap</a> contributors',dldrs:[new TSOSMDownloader({subDomain:"a"}),new TSOSMDownloader({subDomain:"b"}),new TSOSMDownloader({subDomain:"c"})]},A)){return}TilesSquare.call(this,this.options);this.destroy=function(){};tsPushSuperFunc(this,"activate");this.activate=function(B){tsExecSuperFuncs(this,"activate",arguments);var C=document.getElementById(this.cdtid);$(C).html(this.options.credit)};this.cacheMax=50;tsPushSuperFunc(this,"resize");this.resize=function(B){tsExecSuperFuncs(this,"resize",arguments);this.lhalf=(this.width>>1)/this.options.tsize;this.rhalf=((this.width>>1)-1)/(this.options.tsize-1);this.thalf=(this.height>>1)/this.options.tsize;this.bhalf=((this.height>>1)-1)/(this.options.tsize-1);this.cacheMax=this.width/this.options.tsize*this.height/this.options.tsize*8};this.getProjection=function(B){return new TSOSMProjection(B)};this.deltaProjection=function(D){var E=D.prj.getXY(),B=1;if(D.deltaZ){var C=Math.pow(2,D.deltaZ);B=1-1/C}return this.getProjection({zoom:this.options.zoom,x:E.x+D.deltaElemX*B/this.options.tsize,y:E.y+D.deltaElemY*B/this.options.tsize})};this.getDeltaElem=function(D,B){var E=D.getXY(),C=B.getXY();return{deltaElemX:(C.x-E.x)*this.options.tsize,deltaElemY:(C.y-E.y)*this.options.tsize}};this.retrieve=function(){var O=this.options.zoom,F=this.getProjection({zoom:O,lon:this.options.lon,lat:this.options.lat}),G=F.getXY(),J=[1,1.1],E=this.options.dldrs;for(var M=0;M<J.length;M++){var N=Math.floor(G.x-this.lhalf*J[M]),L=Math.floor(G.x+this.rhalf*J[M]),I=Math.floor(G.y-this.thalf*J[M]),H=Math.floor(G.y+this.bhalf*J[M]);for(var P=N;P<=L;P++){for(var D=I;D<=H;D++){var C=this.getProjection({zoom:O,x:P,y:D}),B=C.makeKey();if(!this.caches[B]){var K=E[this.dldrIdx++];if(this.dldrIdx>=E.length){this.dldrIdx=0}this.caches[B]=K.getTileCache(C)}}}}};this.drawTimer=null;this.draw=function(){if(!this.activated){return}if(this.drawTimer!==null){clearTimeout(this.drawTimer);this.drawTimer=null}var R=this.options.tsize,d=(new Date()).getTime(),I=document.getElementById(this.cvsid);if(!I.getContext){return}var g=I.getContext("2d"),a=false,E=null,O=null,U=[{zoom:this.options.zoom,scale:1,alpha:1}],G=this.options.lon,S=this.options.lat;if(this.moveReq){var Q=this.moveReq;if(d<Q.moveEnd){var f=(d-Q.moveStart)/(Q.moveEnd-Q.moveStart),e=1-f,H=this.deltaElem2LonLat({deltaElemX:-(Q.elemX-(this.width>>1)),deltaElemY:-(Q.elemY-(this.height>>1))});if(H.lon<-90&&90<=G){G=G*f+(H.lon+360)*e;if(G>=180){G-=360}}else{if(90<H.lon&&G<-90){G=(G+360)*f+H.lon*e;if(G>=180){G-=360}}else{G=G*f+H.lon*e}}S=S*f+H.lat*e;a=true}else{E=this.moveReq;this.moveReq=undefined}}else{if(this.zoomReq){var Y=this.zoomReq;if(d<Y.zoomEnd){var f=(d-Y.zoomStart)/(Y.zoomEnd-Y.zoomStart),e=1-f,D=this.options.zoom-Y.zoom,H=this.deltaElem2LonLat({deltaZ:(Y.preserve?-D*e:0),deltaElemX:(Y.elemX-(this.width>>1)),deltaElemY:(Y.elemY-(this.height>>1))});G=H.lon;S=H.lat;var T=Math.pow(2,D*f);U[0].scale=T/Math.pow(2,D);U[0].alpha=f;U.unshift({zoom:Y.zoom,scale:T,alpha:1-Math.pow(f,4)});a=true}else{O=this.zoomReq;this.zoomReq=undefined}}}for(var m=0;m<U.length;m++){var J=U[m],R=~~(this.options.tsize*J.scale+0.5),C=this.getProjection({zoom:J.zoom,lon:G,lat:S}),F=C.getXY(),T=(J.scale<0.5?0.5:J.scale),c=Math.floor(F.x-this.lhalf/T),b=Math.floor(F.x+this.rhalf/T),M=Math.floor(F.y-this.thalf/T),K=Math.floor(F.y+this.bhalf/T),j=F.x-this.lhalf/J.scale,P=F.y-this.thalf/J.scale;for(var B=c;B<=b;B++){for(var l=M;l<=K;l++){var V=this.getProjection({zoom:J.zoom,x:B,y:l});var N=this.caches[V.makeKey()],X=Math.round((B-j)*R),W=Math.round((l-P)*R),Z=Math.round((B+1-j)*R)-X,i=Math.round((l+1-P)*R)-W;if(N){N.updateATime();if(N.status==N.LOADED){if(d<N.fadeInEnd){a=true;if(m==0){this.drawBlankTile(X,W,Z,i,1,g)}g.globalAlpha=(d-N.fadeInStart)/(N.fadeInEnd-N.fadeInStart)*J.alpha}else{if(m==0&&J.alpha<0.99999){this.drawBlankTile(X,W,Z,i,1,g)}g.globalAlpha=J.alpha}g.drawImage(N.img,X,W,Z,i)}else{a=true;this.drawBlankTile(X,W,Z,i,m==0?1:J.alpha,g)}}else{this.drawBlankTile(X,W,Z,i,m==0?1:J.alpha,g)}}}}if(this.onDraw){this.onDraw(this)}if(this.dragTimer===null){if(a){var L=this;this.drawTimer=setTimeout(function(){L.draw()},this.options.interval)}else{this.dispose();if(this.onLoaded){this.onLoaded(this)}}}var k=this.lonLat2DeltaElem({lon:G,lat:S});if(this.moveReq){if(this.inMoving){this.inMoving(this,this.moveReq,k)}$("#"+this.ovlsid).tsoverlays("inMoving",this,this.moveReq,k);$("#"+this.popsid).tspopups("inMoving",this,this.moveReq,k)}else{if(this.zoomReq){if(this.inZooming){this.inZooming(this,this.zoomReq,k)}$("#"+this.ovlsid).tsoverlays("inZooming",this,this.zoomReq,k);$("#"+this.popsid).tspopups("inZooming",this,this.zoomReq,k)}else{if(E){$("#"+this.ovlsid).tsoverlays("afterMove",this,E,k);$("#"+this.popsid).tspopups("afterMove",this,E,k);if(this.afterMove){this.afterMove(this,E,k)}}else{if(O){$("#"+this.ovlsid).tsoverlays("afterZoom",this,O,k);$("#"+this.popsid).tspopups("afterZoom",this,O,k);if(this.afterZoom){this.afterZoom(this,O,k)}}}}}};this.drawBlankTile=function(C,G,D,E,F,B){B.globalAlpha=F;B.fillStyle="#e0e0e0";B.fillRect(C,G,D,E)};this.dispose=function(){var C=this.caches,E=[];for(var D in C){E.push(D)}E.sort(function(H,G){var J=C[H].atime,I=C[G].atime;if(J<I){return -1}if(J>I){return 1}return 0});var F=(E.length<=this.cacheMax?0:E.length-this.cacheMax);for(var B=0;B<F;B++){delete C[E[B]]}}}OSMTilesSquare.prototype=new TilesSquare;function MapQuestOSMTilesSquare(A){if(tsAWithB(this,{maxZoom:19,credit:'Tiles Courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" />, © <a href="http://www.openstreetmap.org/">OpenStreetMap</a> contributors',dldrs:[new TSMapQuestOSMDownloader({subDomain:"1"}),new TSMapQuestOSMDownloader({subDomain:"2"}),new TSMapQuestOSMDownloader({subDomain:"3"}),new TSMapQuestOSMDownloader({subDomain:"4"})]},A)){return}OSMTilesSquare.call(this,this.options)}MapQuestOSMTilesSquare.prototype=new OSMTilesSquare;function TSPointerHandler(A){if(tsAWithB(this,{},A)){return}}function TSMouseHandler(A){if(tsAWithB(this,{},A)){return}TSPointerHandler.call(this,this.options);this.init=function(B){var C=B.map;C.isMouseDown=false;C.isMouseMove=false;C.pageX=0;C.pageY=0;C.singleTimer=null};this.onMouseDown=function(B){this.isMouseDown=true;this.isMouseMove=false;this.pageX=B.pageX;this.pageY=B.pageY};this.onMouseUp=function(G){if(!this.isMouseMove){if(this.options.onPointerSingle){if(this.singleTimer!==null){clearTimeout(this.singleTimer)}var I=this,C=$(G.target),F=this.options.active,D=C.offset(),J={elemX:G.pageX-D.left,elemY:G.pageY-D.top},H={deltaElemX:J.elemX-(F.width>>1),deltaElemY:J.elemY-(F.height>>1)},E=F.deltaElem2LonLat(H);this.singleTimer=setTimeout(function(){I.options.onPointerSingle(F,J,E)},300)}}this.isMouseDown=false;this.isMouseMove=false;var B=document.getElementById(this.options.cvsid);$(B).css("cursor","default")};this.onMouseMove=function(C){this.isMouseMove=true;if(this.isMouseDown){var B=document.getElementById(this.options.cvsid);$(B).css("cursor","all-scroll");this.onDrag({deltaElemX:this.pageX-C.pageX,deltaElemY:this.pageY-C.pageY});this.pageX=C.pageX;this.pageY=C.pageY}};this.onMouseOut=function(C){this.isMouseDown=false;this.isMouseMove=false;var B=document.getElementById(this.options.cvsid);$(B).css("cursor","default")};this.onDoubleClick=function(C){if(this.singleTimer!==null){clearTimeout(this.singleTimer);this.singleTimer=null}var B=$(C.target),D=B.offset();this.onZoom({deltaZ:1,elemX:C.pageX-D.left,elemY:C.pageY-D.top})};this.onMouseWheel=function(C,E){if(E===undefined){return}var B=$(C.target),D=B.offset();this.onZoom({deltaZ:this.wheel2deltaZ(E),elemX:C.pageX-D.left,elemY:C.pageY-D.top})};this.getAdapter=function(){var B={mousedown:this.onMouseDown,mouseup:this.onMouseUp,mousemove:this.onMouseMove,mouseout:this.onMouseOut,dblclick:this.onDoubleClick,mousewheel:this.onMouseWheel,DOMMouseScroll:this.onMouseWheel,selectstart:function(){return false},dragstart:function(){return false}};return B}}TSMouseHandler.prototype=new TSPointerHandler;function TSTouchHandler(A){if(tsAWithB(this,{},A)){return}TSPointerHandler.call(this,this.options);this.init=function(B){var C=B.map;C.touches=[];C.pushTouches=this.pushTouches;C.touchEnds=[(new Date()).getTime()];C.pushTouchEnds=this.pushTouchEnds;C.singleTimer=null};this.pushTouches=function(G){var H=this.touches,E=(new Date()).getTime()-250;while(H.length>0&&H[0].ts<E){H.shift()}var F=$(G.target),I=F.offset(),D=G.originalEvent.touches,C=[];for(var B=0;B<D.length;B++){C.push({elemX:D[B].pageX-I.left,elemY:D[B].pageY-I.top})}if(C.length>0){H.push({ts:G.timeStamp,tc:C});if(H.length==3){H.shift()}}};this.pushTouchEnds=function(C){var B=this.touchEnds;B.push(C.timeStamp);if(B.length==3){B.shift()}};this.onTouchStart=function(B){B.preventDefault();this.pushTouches(B)};this.onTouchMove=function(G){G.preventDefault();this.pushTouches(G);this.touchEnds=[];var H=this.touches;if(H.length<2){return}var E=H[0].tc,D=H[1].tc;if(E.length!=D.length){return}if(E.length==1){this.onDrag({deltaElemX:E[0].elemX-D[0].elemX,deltaElemY:E[0].elemY-D[0].elemY})}else{if(E.length==2){var B=Math.pow(E[0].elemX-E[1].elemX,2)+Math.pow(E[0].elemY-E[1].elemY,2),C=Math.pow(D[0].elemX-D[1].elemX,2)+Math.pow(D[0].elemY-D[1].elemY,2),F=Math.sqrt(C)/Math.sqrt(B);this.onZoom({deltaZ:this.pinch2deltaZ(F),elemX:(E[0].elemX+E[1].elemX)>>1,elemY:(E[0].elemY+E[1].elemY)>>1})}}};this.onTouchEnd=function(J){J.preventDefault();this.pushTouchEnds(J);var K=this.touchEnds;if(K.length<2){return}if(this.singleTimer!==null){clearTimeout(this.singleTimer);this.singleTimer=null}if(K[1]-K[0]>300){var M=this,C=$(J.target),I=this.options.active,D=C.offset(),N={elemX:J.originalEvent.changedTouches[0].pageX-D.left,elemY:J.originalEvent.changedTouches[0].pageY-D.top},L={deltaElemX:N.elemX-(I.width>>1),deltaElemY:N.elemY-(I.height>>1)},E=I.deltaElem2LonLat(L);this.singleTimer=setTimeout(function(){M.options.onPointerSingle(I,N,E)},300);return}var F=this.touches;if(F.length<2){return}var H=F[0].tc,G=F[1].tc;if(H.length!=1||G.length!=1){return}var B=Math.pow(G[0].elemX-H[0].elemX,2)+Math.pow(G[0].elemY-H[0].elemY,2);if(B>2500){return}this.onZoom({deltaZ:1,elemX:G[0].elemX,elemY:G[0].elemY})};this.getAdapter=function(){var B={touchstart:this.onTouchStart,touchmove:this.onTouchMove,touchend:this.onTouchEnd};return B}}TSTouchHandler.prototype=new TSPointerHandler;(function(E){var D="0.3.0",C=navigator.userAgent,A=(C.search(/iPhone/)!=-1||C.search(/iPad/)!=-1||C.search(/iPod/)!=-1),B=(C.search(/Android/)!=-1);E.widget("tlsq.tsoverlays",{options:{version:D,left:0,top:0,ovls:{},mapid:undefined,popsid:undefined,ucnt:0},_create:function(){this.element.css("width","1px").css("height","1px").css("margin","0px").css("padding","0px").css("position","absolute").css("left","0px").css("top","0px")},_setOption:function(F,G){switch(F){case"clear":break}this._super(F,G)},_destroy:function(){},mergeOverlays:function(H){var I=this.element,K=this.options.ovls;for(var F=0;F<H.length;F++){var G=H[F],J=G.attr("id");if(!K[J]){K[J]=G;I.append(K[J])}}},removeOverlays:function(G){var K=this.options.ovls;if(!G){for(var J in K){K[J].remove()}this.options.ovls={};return}if(G.ids){for(var F=0;F<G.ids.length;F++){var J=G.ids[F];if(K[J]){K[J].remove();if(K[J]){delete K[J]}}}}if(G.lon1!==undefined&&G.lon2!==undefined){if(G.lon1<G.lon2){for(var J in K){var I=K[J].data("lon");if(I<G.lon1||G.lon2<I){K[J].remove();if(K[J]){delete K[J]}}}}else{for(var J in K){var I=K[J].data("lon");if((0<I&&I<G.lon1)||(G.lon2<I&&I<=0)){K[J].remove();if(K[J]){delete K[J]}}}}}if(G.lat1!==undefined&&G.lat2!==undefined){for(var J in K){var H=K[J].data("lat");if(H<G.lat1||G.lat2<H){K[J].remove();if(K[J]){delete K[J]}}}}},plot:function(G,H){if(!G){return}if(H){this.options.left=G.width>>1;this.options.top=G.height>>1;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")}var L=this.options.ovls;for(var K in L){if(H||L[K].data("status")==1){var F=G.lonLat2DeltaElem({lon:L[K].data("lon"),lat:L[K].data("lat")});var J=F.deltaElemX,I=F.deltaElemY;L[K].left=J;L[K].top=I;L[K].css("left",J+"px").css("top",I+"px");L[K].data("status",2)}}},activate:function(F){this.plot(F,true);this.element.show()},deactivate:function(F){this.element.hide()},beforeDrag:function(G,F){},afterDrag:function(G,F){this.options.left-=F.deltaElemX;this.options.top-=F.deltaElemY;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")},beforeMove:function(G,F){this.options.left-=F.elemX-(G.width>>1);this.options.top-=F.elemY-(G.height>>1)},inMoving:function(G,F,H){this.element.css("left",(this.options.left-H.deltaElemX)+"px").css("top",(this.options.top-H.deltaElemY)+"px")},afterMove:function(G,F,H){this.options.left-=H.deltaElemX;this.options.top-=H.deltaElemY;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")},beforeZoom:function(G,F){this.plot(G,true)},inZooming:function(L,M,N){var J=(new Date()).getTime(),P=(J-M.zoomStart)/(M.zoomEnd-M.zoomStart),I=P>1?1:P,F=1-I,O=L.options.zoom-M.zoom,K=Math.pow(2,-O*F),H=this.options.ovls;if(M.preserve){for(var G in H){H[G].css("left",(H[G].left-N.deltaElemX)*K+"px").css("top",(H[G].top-N.deltaElemY)*K+"px")}}else{for(var G in H){H[G].css("left",H[G].left*K+"px").css("top",H[G].top*K+"px")}}},afterZoom:function(G,F,H){this.plot(G,true)},beforeResize:function(G,F){},afterResize:function(G,F){var I=(G.width-F.width)>>1,H=(G.height-F.height)>>1;this.options.left+=I;this.options.top+=H;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")}});E.widget("tlsq.tsoverlay",{options:{version:D,id:undefined,lon:0,lat:0,width:20,height:20,marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0},_create:function(){var F=this.element.css("width",this.options.width+"px").css("height",this.options.height+"px").css("margin-left",this.options.marginLeft+"px").css("margin-right",this.options.marginRight+"px").css("margin-top",this.options.marginTop+"px").css("margin-bottom",this.options.marginBottom+"px").css("padding-left",this.options.paddingLeft+"px").css("padding-right",this.options.paddingRight+"px").css("padding-top",this.options.paddingTop+"px").css("padding-bottom",this.options.paddingBottom+"px").css("position","absolute").css("left","0px").css("top","0px");if(this.options.id){F.attr("id",this.options.id)}else{this.options.id="overlay_"+(new Date()).getTime()+~~(Math.random()*1000000);F.attr("id",this.options.id)}if(F.is("a")){if(!F.attr("href")){F.attr("href","javascript:void(0)")}}this.element.data("lon",this.options.lon);this.element.data("lat",this.options.lat);this.element.data("status",1);this.element.data("widgetFullName",this.widgetFullName)},_setOption:function(F,G){switch(F){case"clear":break}this._super(F,G)},_destroy:function(){},getMapID:function(){var G=this.element.parent(),F=G.tsoverlays("option","mapid");if(typeof F!="string"){throw new Error("no parent")}return F},getOverlaysID:function(){var G=this.element.parent();if(!G){throw new Error("no parent")}var F=G.attr("id");if(!F){throw new Error("no parent")}return F},getPopupsID:function(){var G=this.element.parent(),F=G.tsoverlays("option","popsid");if(typeof F!="string"){throw new Error("no parent")}return F}});E.widget("tlsq.tsmarker",E.tlsq.tsoverlay,{options:{src:"TilesSquare/img/marker-b.png",title:"",width:21,height:28,marginTop:-28,marginLeft:-10,elev:6},_create:function(){this._super();var F=E("<img />").css("margin","0px").css("padding","0px").css("border-style","none").css("user-select","none").css("-moz-user-select","none").css("-webkit-user-select","none").css("-ms-user-select","none").attr("width",this.options.width).attr("height",this.options.height).attr("src",this.options.src).attr("alt",this.options.title).attr("onSelectStart","return false;");this.element.append(F);this._on({mouseover:function(I){var H=E(this.element),G=H.attr("id"),K=G+"_tooltip",J=E("<div />").tstooltip({id:K,markerID:G,text:this.options.title});J.tstooltip("open",this)},mouseout:function(I){var H=E(this.element),G=H.attr("id"),J=G+"_tooltip";E("#"+J).tstooltip("close")}})},byPopups:function(){var J=E(this.element),F=J.offset(),H=this.getPopupsID(),I=E("#"+H),G=I.offset();return{left:F.left-this.options.marginLeft-G.left,top:F.top-this.options.marginTop-G.top}}});E.widget("tlsq.tspopups",{options:{version:D,left:0,top:0,pops:{},mapid:undefined,ovlsid:undefined,ucnt:0},_create:function(){this.element.css("width","1px").css("height","1px").css("margin","0px").css("padding","0px").css("position","absolute").css("left","0px").css("top","0px")},_setOption:function(F,G){switch(F){case"clear":break}this._super(F,G)},_destroy:function(){},openPopup:function(F){var G=F.element;var I=G.attr("id");if(!I){this.options.ucnt++;I=this.element.attr("id")+"_"+this.options.ucnt;G.attr("id",I)}var H=this.options.pops;if(!H[I]){H[I]=G;this.element.append(G)}},closePopup:function(G){var F=this.options.pops;if(F[G]){F[G].remove();if(F[G]){delete F[G]}}},closePopups:function(H){var M=this.options.pops;if(!H){for(var L in M){M[L].remove()}this.options.pops={};var G=this.options.mapid,J=E("#"+G).tsmap("option","active");if(J){this.options.left=J.width>>1;this.options.top=J.height>>1;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")}return}if(H.ids){for(var F=0;F<H.ids.length;F++){var L=H.ids[F];if(M[L]){M[L].remove();if(M[L]){delete M[L]}}}}if(H.elemX1!==undefined&&H.elemX2!==undefined){for(var L in M){var K=M[L].data("elemX");if(K<H.elemX1||H.elemX2<K){M[L].remove();if(M[L]){delete M[L]}}}}if(H.elemY1!==undefined&&H.elemY2!==undefined){for(var L in M){var I=M[L].data("elemY");if(I<H.elemY1||H.elemY2<I){M[L].remove();if(M[L]){delete M[L]}}}}},activate:function(F){this.closePopups();this.element.show()},deactivate:function(F){this.closePopups();this.element.hide()},beforeDrag:function(G,F){},afterDrag:function(G,F){this.options.left-=F.deltaElemX;this.options.top-=F.deltaElemY;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")},beforeMove:function(G,F){this.options.left-=F.elemX-(G.width>>1);this.options.top-=F.elemY-(G.height>>1)},inMoving:function(G,F,H){this.element.css("left",(this.options.left-H.deltaElemX)+"px").css("top",(this.options.top-H.deltaElemY)+"px")},afterMove:function(G,F,H){this.options.left-=H.deltaElemX;this.options.top-=H.deltaElemY;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")},beforeZoom:function(G,F){this.closePopups();this.element.hide()},inZooming:function(G,F,H){},afterZoom:function(G,F,H){this.element.show()},beforeResize:function(G,F){},afterResize:function(G,F){var I=(G.width-F.width)>>1,H=(G.height-F.height)>>1;this.options.left+=I;this.options.top+=H;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")}});E.widget("tlsq.tspopup",{options:{version:D,id:undefined,margin:0,padding:0,fontSize:12},_create:function(){var F=this.element.css("margin",this.options.margin+"px").css("padding",this.options.padding+"px").css("font-size",this.options.fontSize+"px").css("position","absolute").css("left","0px").css("top","0px");if(this.options.id){F.attr("id",this.options.id)}else{this.options.id="popup_"+(new Date()).getTime();F.attr("id",this.options.id)}this.element.data("widgetFullName",this.widgetFullName)},_setOption:function(F,G){switch(F){case"clear":break}this._super(F,G)},_destroy:function(){},getMapID:function(){var G=this.element.parent(),F=G.tspopups("option","mapid");if(typeof F!="string"){throw new Error("no parent")}return F},getOverlaysID:function(){var G=this.element.parent(),F=G.tspopups("option","ovlsid");if(typeof F!="string"){throw new Error("no parent")}return F},getPopupsID:function(){var G=this.element.parent();if(!G){throw new Error("no parent")}var F=G.attr("id");if(!F){throw new Error("no parent")}return F},open:function(G){var F=G.getPopupsID();popups=E("#"+F);popups.tspopups("closePopups");popups.tspopups("openPopup",this)},close:function(G){if(!G){G=this}var F=G.getPopupsID();E("#"+F).tspopups("closePopups")}});E.widget("tlsq.tstooltip",E.tlsq.tspopup,{options:{width:100,padding:4,borderWidth:2},_create:function(){this._super();var F=this.element.css("background-color","#fff").css("padding",this.options.padding+"px").css("width",this.options.width+"px").css("text-align","center").css("position","absolute").css("border",this.options.borderWidth+"px solid #548").css("border-radius","8px").css("opacity","0.0");F=E("<span />").css("margin","0px").css("padding","0px").css("position","relative");if(this.options.text){F.text(this.options.text)}this.element.append(F)},open:function(F){this._super(F);var I=this.element,L=I.children(),H=(this.options.padding+this.options.borderWidth)*2;if(L.width()+H<this.options.width){this.options.width=L.width()+H;I.css("width",this.options.width)}var G=F.byPopups(),H=this.options.padding+this.options.borderWidth,K=G.left-(this.options.width>>1)-H,J=G.top-F.options.height-I.height()-H*2-F.options.elev;I.css("left",K+"px").css("top",(J+4)+"px").animate({top:J+"px",opacity:"0.8"},200)}});E.widget("tlsq.tssignboard",E.tlsq.tspopup,{options:{width:100,height:100,padding:18,borderWidth1:2,borderWidth2:1,closable:false,markerElev:0},_create:function(){this._super();var L=this,I=function(){if(!L.options.closable){return}L.close()};this.options.maskID=this.options.id+"_mask";var N=E("<div />").attr("id",this.options.maskID).css("background-color","black").css("position","absolute").css("opacity","0.6").click(I),G=this.element;G.css("opacity","0.0");G.append(N);this.options.frameID=this.options.id+"_frame";var F=E("<div />").attr("id",this.options.frameID).css("background-color","#dbf").css("position","absolute").css("border",this.options.borderWidth1+"px solid #548").css("border-radius","8px");G.append(F);var J=E("<a />").attr("href","javascript:void(0)").css("position","absolute").css("right","3px").css("top","3px").click(I),K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAVlJREFUOMudk71uFEEQhL/aswSBE8hMhNNLsAnADjBERCRoe+zAuhiR8C5kPAACCbcsAggQweEAIUuAHaCT34InsItk9zQsd/x1NqOq7lJ/MzCoiBD/U6WUUUQ8/JMuInZKKdf6c9OZLwFT4DAinvzGfB84Aj6WUtbmDWyv274jCeBpRDxaYL4HvJOE7eu2b88bZOYZsGUbSUh6VifpJk87M8AkM19HhDSYclPSly4VwGPgTNK0utvLzFe9RwuibgGfVPXuk9meZObzWq8lRG7ZPgIuA735p8l9rSxZ+CrQ9Cm6BFcWCUdLUL2XNLJ9DlxIamw/GI/H32ez2XGtbwbmuxUqgAmw3e9gEeJmMPnDANXLzPxcIwbmiOcYI2JD0kmFajczDwbpNoGv1YD9zHzRP6RT22867WRo7jQnwHZH5Zvtt79stG3bnb/4TDci4upSQdu2//SdfwBsRqV2wx83WgAAAABJRU5ErkJggg==",M=E("<img />").css("margin","0px").css("padding","0px").css("border-style","none").attr("src",K).attr("alt","close button");J.append(M);F.append(J);this.options.contentID=this.options.id+"_content";var H=E("<div />").attr("id",this.options.contentID).css("background-color","#fff").css("margin","0px").css("padding","0px").css("position","absolute").css("border",this.options.borderWidth2+"px inset #ecf").css("left","0px").css("top","0px");F.append(H)},open:function(N){this._super(N);var L=this.getMapID(),W=E("#"+L),F=W.tsmap("option","active"),G=this.getPopupsID(),M=E("#"+G),O=M.offset();E("#"+this.options.maskID).css("width",F.width*3).css("height",F.height*3).css("left",(-O.left-F.width)+"px").css("top",(-O.top-F.height)+"px");if(F.hasSlider){this.options.width=F.width-300;this.options.height=F.height-N.options.height*2-60}else{this.options.width=F.width;this.options.height=F.height-N.options.height*2}var P=E("#"+this.options.frameID).css("width",this.options.width+"px").css("height",this.options.height+"px"),U=this.options.padding+this.options.borderWidth1;E("#"+this.options.contentID).css("width",(this.options.width-U*2)+"px").css("height",(this.options.height-U*2)+"px").css("left",U+"px").css("top",U+"px");this.options.dmMarkerID=this.options.id+"_dmMarker";var I=N.element.offset(),H=E("<img />").attr("id",this.options.dmMarkerID).attr("src",N.options.src).css("margin","0px").css("padding","0px").css("position","absolute").css("border-style","none").css("left",(I.left-O.left)+"px").css("top",(I.top-O.top)+"px"),T=this.element;T.append(H);var K=N.byPopups(),P=E("#"+this.options.frameID),U=this.options.borderWidth1,J=K.left-(P.width()>>1)-U,Q=K.top-N.options.height-P.height()-U*2-N.options.elev,S=500,R=this;P.css("left",J+"px").css("top",(Q+50)+"px");P.animate({top:Q+"px"},S);T.animate({opacity:"1.0"},S);N.element.animate({opacity:"0.0"},S);setTimeout(function(){R.options.closable=true},S);var V=W.offset();F.onMove({elemX:I.left-V.left-N.options.marginLeft,elemY:I.top-V.top-N.options.marginTop-(P.height()>>1)-U-N.options.elev});this.options.markerElev=N.options.elev},close:function(){var M=500;this.element.animate({opacity:"0"},M);var I=E("#"+this.options.markerID);I.animate({opacity:"1.0"},M);var L=this.getMapID(),F=E("#"+L),J=F.tsmap("option","active"),G=E("#"+this.options.frameID),H=this.options.borderWidth1;J.onMove({elemX:J.width>>1,elemY:(J.height>>1)+(G.height()>>1)+H+this.options.markerElev});var N=this,K=N._super;setTimeout(function(){K(N)},M+20)}});E.widget("tlsq.tsmap",{options:{version:D,width:0,height:0,tss:[],zoom:12,overlays:undefined,lon:139.6916667,lat:35.6894444,hasArrows:!(A||B),hasSlider:!(A||B),hasPlsMns:true,hasScale:true,active:undefined,onCreate:undefined,onActivate:undefined,onDeactivate:undefined,beforeDrag:undefined,afterDrag:undefined,beforeMove:undefined,inMoving:undefined,afterMove:undefined,beforeZoom:undefined,inZooming:undefined,afterZoom:undefined,beforeResize:undefined,afterResize:undefined,onDraw:undefined,onLoaded:undefined,onPointerSingle:undefined},_create:function(){this.options.isIOS=A;this.options.isAndroid=B;this.options.isAutoFit=(this.options.width==0&&this.options.height==0);var U=this.element.css("position","relative").css("width",this.options.isAutoFit?E(window).width():this.options.width+"px").css("height",this.options.isAutoFit?E(window).height():this.options.height+"px").css("z-index",30000).css("overflow","hidden");var K=U.attr("id");this.options.cvsid=K+"_canvas";var J=E("<canvas />").attr("id",this.options.cvsid).attr("width",this.options.isAutoFit?E(window).width():this.options.width).attr("height",this.options.isAutoFit?E(window).height():this.options.height);U.append(J);this.onDrag=function(X){if(this.options.active){this.options.active.onDrag(X)}};this.onMove=function(X){if(this.options.active){this.options.active.onMove(X)}};this.onZoom=function(X){if(this.options.active){this.options.active.onZoom(X)}};if("ontouchstart" in window){this.pointerHandler=new TSTouchHandler();this.pinch2deltaZ=function(X){return(this.options.active?this.options.active.pinch2deltaZ(X):0)}}else{this.pointerHandler=new TSMouseHandler();this.wheel2deltaZ=function(X){return(this.options.active?this.options.active.wheel2deltaZ(X):0)}}this.pointerHandler.init({map:this,cvsid:this.options.cvsid});this._on(J,this.pointerHandler.getAdapter());if(this.options.isAutoFit){this.onResize=function(){var Y=E(window).width(),X=E(window).height(),Z=this.options.cvsid;E(this.element).css("width",Y+"px").css("height",X+"px"),E(document.getElementById(Z)).attr("width",Y).attr("height",X);if(this.options.active){this.options.active.onResize({width:Y,height:X})}};this._on(window,{resize:this.onResize})}var V=(this.options.overlays?this.options.overlays:E("<div />").tsoverlays()),S=V.attr("id");if(!S){S=K+"_overlays";V.attr("id",S)}this.options.ovlsid=S;U.append(V);this.options.cdtid=K+"_credit";var G=E("<div />").attr("id",this.options.cdtid).css("background-color","rgba(0,0,0,.2)").css("margin","0px").css("padding","2px 6px").css("font-size","10px").css("position","absolute").css("right","0px").css("bottom","0px");U.append(G);var P=this;var O={nw:[11,11,-1,-1],n:[36,11,0,-1],ne:[61,11,1,-1],w:[11,36,-1,0],e:[61,36,1,0],sw:[11,61,-1,1],s:[36,61,0,1],se:[61,61,1,1]};this.options.arwids={};if(this.options.hasArrows){for(var W in O){this.options.arwids[W]=K+"_arrow_"+W;var F=E("<div />").attr("id",this.options.arwids[W]).css("width","18px").css("height","18px").css("position","absolute").css("left",O[W][0]+"px").css("top",O[W][1]+"px").data("signX",O[W][2]).data("signY",O[W][3]).data("onMove",function(b,a){var Z=P.element,Y=Z.width(),X=Z.height();P.onMove({elemX:~~((Y>>1)+b*Y*2/3),elemY:~~((X>>1)+a*X*2/3)})});U.append(F);F.button({icons:{primary:"ui-icon-triangle-1-"+W},text:false}).click(function(Y){Y.preventDefault();var X=E(this);X.data("onMove")(X.data("signX"),X.data("signY"))})}}this.options.sldid=K+"_slider";if(this.options.hasSlider){var R=E("<div />").attr("id",this.options.sldid).css("height","100px").css("position","absolute").css("top","130px").data("onZoom",function(X){P.onZoom({zoom:X})});U.append(R);R.slider({orientation:"vertical",range:"max",min:0,max:20,slide:function(X,Y){E(this).data("onZoom")(Y.value)}});R.css("left",~~((90-R.width())/2)+"px");R.children().each(function(){E(this).css("z-index","auto")})}var T;if(this.options.hasArrows){if(this.options.hasSlider){T={plus:[36,101,1],minus:[36,241,-1]}}else{T={plus:[36,101,1],minus:[36,126,-1]}}}else{T={plus:[11,11,1],minus:[11,36,-1]}}this.options.pmids={};if(this.options.hasPlsMns){for(var W in T){this.options.pmids[W]=K+"_"+W;var F=E("<div />").attr("id",this.options.pmids[W]).css("width","18px").css("height","18px").css("position","absolute").css("left",T[W][0]+"px").css("top",T[W][1]+"px").data("deltaZ",T[W][2]).data("onZoom",function(X){P.onZoom({deltaZ:X})});U.append(F);F.button({icons:{primary:"ui-icon-"+W},text:false}).click(function(Y){Y.preventDefault();var X=E(this);X.data("onZoom")(X.data("deltaZ"))})}}var H={left:[2,22,6,10],horizon:[100,2,6,20],kmLine:[2,10,84,22],miLine:[2,10,84,10]},N={kmLabel:[80,10,12,26],miLabel:[80,10,12,6]};this.options.sclids={};if(this.options.hasScale){for(var W in H){this.options.sclids[W]=K+"_scale_"+W;var M=this.options.sclids[W],Q=E("<div />").attr("id",M).css("background-color","#000").css("width",H[W][0]+"px").css("height",H[W][1]+"px").css("margin","0px").css("padding","0px").css("position","absolute").css("left",H[W][2]+"px").css("bottom",H[W][3]+"px");U.append(Q)}for(var W in N){this.options.sclids[W]=K+"_scale_"+W;var M=this.options.sclids[W],Q=E("<div />").attr("id",M).css("width",N[W][0]+"px").css("height",N[W][1]+"px").css("margin","0px").css("padding","0px").css("font-size","10px").css("line-height","10px").css("position","absolute").css("left",N[W][2]+"px").css("bottom",N[W][3]+"px");U.append(Q)}}var L=(this.options.popups?this.options.popups:E("<div />").tspopups()),I=L.attr("id");if(!I){I=K+"_popups";L.attr("id",I)}this.options.popsid=I;L.tspopups("option","ovlsid",this.options.ovlsid);V.tsoverlays("option","popsid",I);L.tspopups("option","mapid",K);V.tsoverlays("option","mapid",K);U.append(L);if(this.options.onCreate){this.options.onCreate(K,this.options.ovlsid,this.options.popsid)}},_setOption:function(F,G){switch(F){case"clear":break}this._super(F,G)},_destroy:function(){var G=this.options.tss;for(var F=0;F<G.length;F++){if(G[F].initialized){G[F].destroy()}}},select:function(K){var M=this.options.cvsid,I=E(document.getElementById(M)),J=I.attr("width"),G=I.attr("height"),H=this.options.tss,L=-1;for(var F=0;F<H.length;F++){if(H[F].options.id==K){L=F}else{if(H[F].initialized&&H[F].activated){this.options.zoom=H[F].options.zoom;this.options.lon=H[F].options.lon;this.options.lat=H[F].options.lat;H[F].deactivate()}}}if(L>=0){if(!H[L].initialized){H[L].init({isIOS:this.options.isIOS,isAndroid:this.options.isAndroid,interval:this.options.interval,cvsid:M,cdtid:this.options.cdtid,hasArrows:this.options.hasArrows,arwids:this.options.arwids,hasSlider:this.options.hasSlider,sldid:this.options.sldid,hasPlsMns:this.options.hasPlsMns,pmids:this.options.pmids,hasScale:this.options.hasScale,sclids:this.options.sclids,ovlsid:this.options.ovlsid,popsid:this.options.popsid,onActivate:this.options.onActivate,onDeactivate:this.options.onDeactivate,beforeDrag:this.options.beforeDrag,afterDrag:this.options.afterDrag,beforeMove:this.options.beforeMove,inMoving:this.options.inMoving,afterMove:this.options.afterMove,beforeZoom:this.options.beforeZoom,inZooming:this.options.inZooming,afterZoom:this.options.afterZoom,beforeResize:this.options.beforeResize,afterResize:this.options.afterResize,onDraw:this.options.onDraw,onLoaded:this.options.onLoaded,width:J,height:G})}if(this.options.zoom<H[L].options.minZoom){this.options.zoom=H[L].options.minZoom}else{if(this.options.zoom>H[L].options.maxZoom){this.options.zoom=H[L].options.maxZoom}}H[L].activate({width:J,height:G,zoom:this.options.zoom,lon:this.options.lon,lat:this.options.lat});this.options.active=H[L]}}})}(jQuery));